SELECT * FROM choretail_db.`retail chocolate sales`;

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                   --  CREATE DUPLICATE TABLE FOR THE EDA --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE re_choco_sales 
LIKE `retail chocolate sales`;

INSERT INTO re_choco_sales 
SELECT *
FROM `retail chocolate sales`;


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                   --  RENAME SOME COLUMNS --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

ALTER TABLE re_choco_sales
RENAME COLUMN `ï»¿Sales Person` TO Sales_Person;

ALTER TABLE re_choco_sales
RENAME COLUMN `Boxes Shipped` TO Boxes_Shipped;


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                   -- FORMAT DATE COLUMN FROM STRING TO DATE--
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT `Date`,
	STR_TO_DATE(`Date`, '%m/%d/%Y') AS Rec_Date
FROM re_choco_sales;

UPDATE re_choco_sales
SET `Date` = STR_TO_DATE(`Date`, '%m/%d/%Y');


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                   -- FORMAT DATE COLUMN INTO A DATE COLUMN --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

ALTER TABLE re_choco_sales
MODIFY `Date` DATE;


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                   -- FORMAT AMOUNT COLUMN INTO DECIMAL --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT Amount,
	SUBSTRING(Amount, 2,8)
FROM re_choco_sales;

UPDATE re_choco_sales
SET Amount = SUBSTRING(Amount, 2,8);

SELECT Amount,
	REPLACE(Amount, ',', '')
FROM re_choco_sales;

UPDATE re_choco_sales
SET Amount = REPLACE(Amount, ',', '');

ALTER TABLE re_choco_sales
MODIFY Amount FLOAT(7,4);

SELECT MAX(Amount)
FROM re_choco_sales;

SELECT * 
FROM re_choco_sales;


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                   -- CHECK THE DUPLICATES --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT *,
	ROW_NUMBER() OVER
    (PARTITION BY Sales_Person, Country, Product, `Date`, Amount, `Boxes_Shipped`) AS Row_Num
FROM re_choco_sales;

WITH CTE_cho_dupl AS
(
SELECT *,
	ROW_NUMBER() OVER
    (PARTITION BY Sales_Person, Country, Product, `Date`, Amount, `Boxes_Shipped`) AS Row_Num
FROM re_choco_sales
)
SELECT *
FROM CTE_cho_dupl 
WHERE Row_Num > 1;

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                     -- CHECK THE EMPTY COLUMN --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT Sales_Person
FROM re_choco_sales
WHERE Sales_Person = '';

SELECT Country
FROM re_choco_sales
WHERE Country = '';

SELECT *
FROM re_choco_sales
WHERE Product = '';

SELECT *
FROM re_choco_sales
WHERE `Date` = '';

SELECT *
FROM re_choco_sales
WHERE Amount = '';

SELECT Sales_Person
FROM re_choco_sales
WHERE Boxes_Shipped = '';


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                     -- DISTINCT SALES PERSON --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT 
COUNT(DISTINCT Sales_Person) AS Total_SalesPerson
FROM re_choco_sales ;

SELECT 
DISTINCT(Sales_Person)
FROM re_choco_sales ;


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                     -- DISTINCT SALES PRODUCT --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT 
COUNT(DISTINCT Product) AS Total_Product
FROM re_choco_sales ;

SELECT 
DISTINCT(Product)
FROM re_choco_sales ;


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                     -- DISTINCT COUNTRTY --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT 
DISTINCT Country
FROM re_choco_sales; 

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
											-- EXTRACT MONTH AND YEAR OF THE PURSHASE FROM THE DATE COLUMN --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

ALTER TABLE re_choco_sales
ADD COLUMN `Month` VARCHAR(15);

SELECT DISTINCT MONTHNAME(`Date`) AS `Month`
	FROM re_choco_sales;
    
UPDATE re_choco_sales
SET `Month` = MONTHNAME(`Date`);


--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
											-- EXTRACT DAY OF THE PURSHASE FROM THE DATE COLUMN --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

ALTER TABLE re_choco_sales
ADD COLUMN `Day` VARCHAR(15);

SELECT DISTINCT DAYNAME(`Date`) AS `Day`
	FROM re_choco_sales;
    
UPDATE re_choco_sales
SET `Day` = DAYNAME(`Date`);


--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
										              	-- THE TOTAL REVENUE--
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT SUM(Amount) AS Total_Revenue
FROM re_choco_sales;

SELECT MAX(Amount) AS Sale
FROM re_choco_sales;

SELECT AVG(Amount) AS Average
FROM re_choco_sales;

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
											-- THE TOTAL REVENUE GENERATED BY EACH COUNTRY--
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT DISTINCT Country,
	SUM(Amount) AS Total_Revenue
FROM re_choco_sales
	GROUP BY Country
    ORDER BY Total_Revenue DESC;


--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
											-- THE TOTAL REVENUE GENERATED BY PRODUCT TYPES--
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT DISTINCT Product,
	SUM(Amount) AS Total_Revenue
FROM re_choco_sales
	GROUP BY Product
    ORDER BY Total_Revenue DESC
    LIMIT 5;


--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
											-- THE UNDERFORMING PRODUCT TYPE--
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------


SELECT DISTINCT Product,
	SUM(Amount) AS Total_Revenue
FROM re_choco_sales
	GROUP BY Product
    ORDER BY Total_Revenue ASC
    LIMIT 5;


--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
											-- TOTAL SALES BY SALES PERSONS --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT Sales_Person,
	SUM(Amount) AS Total_Revenue
FROM re_choco_sales
	GROUP BY Sales_Person
    ORDER BY Total_Revenue DESC
    LIMIT 5;


--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
											-- REVENUE GENERATED BY BOX SHIPPED --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT Boxes_Shipped, Amount
FROM re_choco_sales
	ORDER BY Amount DESC;
    
SELECT Boxes_Shipped, Amount
FROM re_choco_sales
	ORDER BY Boxes_Shipped DESC;


--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
											-- REVENUE GENERATED BY SEASONALITY --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SELECT `Month`,
	SUM(Amount) AS Total_Revenue_Generated
FROM re_choco_sales
	GROUP BY `Month`
    ORDER BY Total_Revenue_Generated DESC;
    
SELECT `Day`,
	SUM(Amount) AS Total_Revenue_Generated
FROM re_choco_sales
	GROUP BY `Day`
    ORDER BY Total_Revenue_Generated DESC;
    



--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
											                   -- THE END --
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------




















